<!doctype html>
<html lang="ja" data-theme="dark">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>log | drmnuit</title>
   <link rel="icon" href="/favicon.png">
 <link rel="stylesheet" href="/style.css" />
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.min.css">
</head>
<body>
 <div id="siteHeader" data-include="/header-main.html"></div>

  <main>
    <h1>log</h1>
    <section class="card">
       <h2>news</h2>
        <!-- <p>
        更新のお知らせや近況などをまとめていきます。
        <br>気が向いたときに、少しずつ書いていきます。
        <br>
        ご感想などありましたら、
        <a href="https://forms.gle/LJxLwSZttBrNK5fa7" target="_blank" rel="noopener">
        こちらから <i class="bi bi-box-arrow-up-right"></i>
        </a> お送りください。
        </p> -->

       <div id="logList" class="log-list"></div>
    </section>

  <dialog id="logDialog" class="log-dialog">
    <button id="closeDialog" class="dialog-close" type="button">×</button>
    <h2 id="dlgTitle"></h2>
    <p id="dlgDate" class="small"></p>
    <div id="dlgBody" class="log-body"></div>
  </dialog>

<section class="card">
  <h2>message</h2>
  
    <!-- <form id="messageForm" name="message" method="POST"
      data-netlify="true" netlify-honeypot="bot-field"> -->

  <form id="messageForm"
      name="message"
      method="POST"
      action="/log/"
      data-netlify="true"
      netlify-honeypot="bot-field">


  <input type="hidden" name="form-name" value="message">

  <p hidden>
    <label>Don’t fill this out: <input name="bot-field"></label>
  </p>

  <input type="text" name="sender" placeholder="name（任意）" autocomplete="nickname"/>
  <br>
  <textarea name="text" rows="4" placeholder="ひとこと・感想など" required></textarea>

  <div class="actions">
    <button type="submit">send</button>
  </div>
</form>

  <!-- ありがとうモーダル -->
  <div id="thanksModal" class="modal" hidden aria-hidden="true">
    <div class="modal__backdrop" data-close></div>
    <div class="modal__panel" role="dialog" aria-modal="true" aria-label="Thanks">
      <p>ありがとう。</p>
      <div class="actions">
        <button type="button" class="btn" data-close>close</button>
      </div>
    </div>
  </div>
</section>

</main>

<script src="/theme.js?v=1"></script>
<script src="/include.js?v=1"></script>
<script src="/header-main.js?v=1"></script>
<script src="./log.js?v=1001"></script>

<script>
  const form = document.getElementById("messageForm");
  const modal = document.getElementById("thanksModal");

  function openModal() {
    modal.hidden = false;
    modal.setAttribute("aria-hidden", "false");
    document.body.style.overflow = "hidden";
  }

  function closeModal() {
    modal.hidden = true;
    modal.setAttribute("aria-hidden", "true");
    document.body.style.overflow = "";
  }

  modal?.addEventListener("click", (e) => {
    if (e.target.matches("[data-close]")) closeModal();
  });

  document.addEventListener("keydown", (e) => {
    if (e.key === "Escape" && modal && !modal.hidden) closeModal();
  });

  form?.addEventListener("submit", async (e) => {
    e.preventDefault();

    const fd = new FormData(form);
    const url = form.getAttribute("action") || window.location.pathname;

    try {
      const res = await fetch(url, {
        method: "POST",
        headers: { "Content-Type": "application/x-www-form-urlencoded" },
        body: new URLSearchParams(fd).toString(),
      });

      if (!res.ok) throw new Error("submit failed");

      form.reset();
      openModal();
    } catch (err) {
      alert("送信に失敗しました。時間をおいて試してください。");
      console.error(err);
    }
  });
</script>


</body>
</html>

<style>
  .log-list {
  display: grid;
  gap: 10px;
  margin-top: 20px;
}

.log-item {
  width: 100%;
  text-align: left;
  border: 1px solid var(--border);
  background: transparent;
  color: var(--text);
  border-radius: 12px;
  padding: 12px 14px;
  display: flex;
  justify-content: space-between;
  gap: 12px;
  cursor: pointer;
}

.log-item:hover { opacity: .92; }

.log-dialog {
  border: 1px solid var(--border);
  border-radius: 14px;
  padding: 18px 16px;
  width: min(720px, 92vw);
  color: var(--text);
  background: var(--bg);
  position: relative; z-index: 1000;
}

.dialog-close {
  position: absolute;
  right: 10px;
  top: 8px;
  border: none;
  background: transparent;
  color: var(--text);
  font-size: 22px;
  cursor: pointer;
  opacity: .7;
}
.dialog-close:hover { opacity: 1; }

.log-body {
  margin-top: 12px;
  line-height: 1.8;
}
.log-body p { margin: 0 0 10px; }

input[type="text"],
textarea {
  width: 100%;
  padding: 12px;
  border-radius: 12px;
  border: 1px solid var(--border);
  background: var(--bg-soft);
  color: var(--text);
  font-family: -apple-system, BlinkMacSystemFont, "Hiragino Sans", "Noto Sans JP", sans-serif;
}

.log-dialog::backdrop {
  background: rgba(0,0,0,.45);
}

.modal[hidden] { display: none; }
.modal {
  position: fixed;
  inset: 0;
  z-index: 9999;
}
.modal__backdrop {
  position: absolute;
  inset: 0;
  background: rgba(0,0,0,.45);
}
.modal__panel {
  position: relative;
  max-width: 420px;
  margin: 24vh auto 0;
  padding: 18px;
  border-radius: 16px;
  border: 1px solid rgba(255,255,255,.10);
  background: rgba(20,24,32,.92);
  backdrop-filter: blur(10px);
}
.modal__panel p {
  margin: 0;
  font-size: 16px;
}

</style>
